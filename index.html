<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Loss Function Visualization</title>
  <!-- Include Plotly.js via CDN -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- Include MathJax for LaTeX rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      background-color: #f5f7fa;
      margin: 0;
      padding: 20px;
    }
    #container {
      max-width: 800px;
      margin: 0 auto;
    }
    /* Hidden equations section */
    #equations {
      display: none;
    }
    #plot-container {
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-top: 30px;
    }
    #plot {
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
    }
    #info {
      margin-top: 20px;
    }
    #info p {
      font-size: 18px;
    }
    #info span {
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div id="container">

    <!-- Equations section is hidden -->
    <div id="equations">
      <p><strong>Model Equation:</strong></p>
      <p class="equation">\(\hat{y} = \theta\)</p>
      <p><strong>Loss Function:</strong></p>
      <p class="equation">\(L(\theta) = (\hat{y} - y)^2\)</p>
      <p>In this example, the model prediction \(\hat{y}\) is the parameter \(\theta\), and we're trying to match an unknown true value \(y\).</p>
    </div>

    <!-- Plot container with shadow border -->
    <div id="plot-container">
      <div id="plot"></div>

      <div id="info">
        <p>Model Parameter (\(\theta\)): <span id="theta-value">0</span></p>
        <p>Loss (\(L(\theta)\)): <span id="loss-value">400</span></p>
      </div>
    </div>

  </div>

  <!-- MathJax Configuration -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(','\\)'], ['\\[','\\]']],
        processEscapes: true
      },
      svg: {
        fontCache: 'global'
      }
    };
  </script>

  <!-- Plotly.js and MathJax Scripts -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <script>
    // Hidden true value we're trying to predict
    const y_true = 20;

    // Define the loss function: L(θ) = (θ - y_true)^2
    function lossFunction(theta) {
      return Math.pow(theta - y_true, 2);
    }

    // Generate data for the loss function curve
    const thetaValues = [];
    const lossValues = [];
    for (let theta = -10; theta <= 50; theta += 0.1) {
      thetaValues.push(theta);
      lossValues.push(lossFunction(theta));
    }

    // Initial parameter value
    let currentTheta = 0;

    // Function to format loss values, showing zero instead of very small numbers
    function formatLoss(loss) {
      return Math.abs(loss) < 1e-6 ? '0' : loss.toFixed(2);
    }

    // Plotly data and layout
    const data = [
      {
        x: thetaValues,
        y: lossValues,
        mode: 'lines',
        name: 'Loss Function',
        line: { color: '#ff7f0e' },
        hoverinfo: 'none' // Disable tooltip for the loss function line
      },
      {
        x: [currentTheta],
        y: [lossFunction(currentTheta)],
        mode: 'markers',
        name: 'Current θ',
        marker: { color: '#1f77b4', size: 12 },
        hovertemplate: 'Model Parameter (θ): %{x:.2f}<br>Loss: %{customdata}<extra></extra>',
        customdata: [formatLoss(lossFunction(currentTheta))]
      }
    ];

    const layout = {
      xaxis: {
        title: 'Model Parameter (θ)',
        range: [-10, 50],
        zeroline: true,
        showgrid: false
      },
      yaxis: {
        title: 'Loss',
        range: [0, 1600],
        zeroline: true,
        showgrid: false
      },
      margin: { t: 20 },
      plot_bgcolor: '#f5f7fa',
      paper_bgcolor: '#f5f7fa',
      showlegend: false,
      hovermode: 'x', // Allows hovering over the x-axis
      dragmode: false // Disable zooming and panning
    };

    const config = {
      responsive: true,
      displayModeBar: false, // Hide the mode bar (toolbar)
      staticPlot: false, // Keep interactivity
      scrollZoom: false // Disable scroll zoom
    };

    Plotly.newPlot('plot', data, layout, config);

    // Add event listener for interacting with the plot
    const plotElement = document.getElementById('plot');

    plotElement.on('plotly_hover', function(eventdata) {
      const x = eventdata.points[0].x;
      updateCurrentTheta(x);
    });

    plotElement.on('plotly_click', function(eventdata) {
      const x = eventdata.points[0].x;
      updateCurrentTheta(x);
    });

    // Function to update the current θ and displayed values
    function updateCurrentTheta(theta) {
      currentTheta = theta;

      // Update the marker position and customdata for tooltip
      Plotly.update('plot', {
        x: [[currentTheta]],
        y: [[lossFunction(currentTheta)]],
        customdata: [[formatLoss(lossFunction(currentTheta))]]
      }, {}, [1]);

      // Update the displayed θ and loss values
      document.getElementById('theta-value').innerText = currentTheta.toFixed(2);
      document.getElementById('loss-value').innerText = formatLoss(lossFunction(currentTheta));
    }

    // Initialize the displayed values
    updateCurrentTheta(currentTheta);

    // Prevent zooming and panning
    plotElement.on('plotly_relayout', function(eventdata) {
      if (eventdata['xaxis.range[0]'] || eventdata['yaxis.range[0]']) {
        Plotly.relayout('plot', {
          'xaxis.autorange': true,
          'yaxis.autorange': true
        });
      }
    });

  </script>

</body>
</html>
