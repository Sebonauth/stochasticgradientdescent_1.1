<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Loss Function Visualization</title>
  <!-- Include Plotly.js via CDN -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    /* Remove default margins and paddings */
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden; /* Hide scrollbars */
    }
    /* Make the plot fill the entire viewport */
    #plot {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>

  <div id="plot"></div>

  <script>
    // Hidden true value we're trying to predict
    const y_true = 20;

    // Define the loss function: L(θ) = (θ - y_true)^2
    function lossFunction(theta) {
      return Math.pow(theta - y_true, 2);
    }

    // Generate data for the loss function curve
    const thetaValues = [];
    const lossValues = [];
    for (let theta = -10; theta <= 50; theta += 0.1) {
      thetaValues.push(theta);
      lossValues.push(lossFunction(theta));
    }

    // Initial parameter value
    let currentTheta = 0;

    // Function to format loss values, showing zero instead of very small numbers
    function formatLoss(loss) {
      return Math.abs(loss) < 1e-6 ? '0' : loss.toFixed(2);
    }

    // Plotly data and layout
    const data = [
      {
        x: thetaValues,
        y: lossValues,
        mode: 'lines',
        line: { color: '#ff7f0e' },
        hoverinfo: 'none' // Disable tooltip for the loss function line
      },
      {
        x: [currentTheta],
        y: [lossFunction(currentTheta)],
        mode: 'markers',
        marker: { color: '#1f77b4', size: 12 },
        hovertemplate: 'Model Parameter (θ): %{x:.2f}<br>Loss: %{customdata}<extra></extra>',
        customdata: [formatLoss(lossFunction(currentTheta))]
      }
    ];

    const layout = {
      xaxis: {
        title: 'Model Parameter (θ)',
        range: [-10, 50],
        zeroline: true,
        showgrid: false,
        fixedrange: true // Disable zooming on x-axis
      },
      yaxis: {
        title: 'Loss',
        range: [0, 1600],
        zeroline: true,
        showgrid: false,
        fixedrange: true // Disable zooming on y-axis
      },
      margin: { t: 20, l: 50, r: 20, b: 50 },
      hovermode: 'x', // Allows hovering over the x-axis
      dragmode: false // Disable zooming and panning
    };

    const config = {
      responsive: true,
      displayModeBar: false, // Hide the mode bar (toolbar)
      staticPlot: false,     // Keep interactivity
      scrollZoom: false      // Disable scroll zoom
    };

    Plotly.newPlot('plot', data, layout, config);

    // Add event listener for interacting with the plot
    const plotElement = document.getElementById('plot');

    plotElement.on('plotly_hover', function(eventdata) {
      const x = eventdata.points[0].x;
      updateCurrentTheta(x);
    });

    plotElement.on('plotly_click', function(eventdata) {
      const x = eventdata.points[0].x;
      updateCurrentTheta(x);
    });

    // Function to update the current θ and displayed values
    function updateCurrentTheta(theta) {
      currentTheta = theta;

      // Update the marker position and customdata for tooltip
      Plotly.update('plot', {
        x: [[currentTheta]],
        y: [[lossFunction(currentTheta)]],
        customdata: [[formatLoss(lossFunction(currentTheta))]]
      }, {}, [1]);
    }

    // Initialize the displayed values
    updateCurrentTheta(currentTheta);

    // Prevent zooming and panning
    plotElement.on('plotly_relayout', function(eventdata) {
      if (eventdata['xaxis.range[0]'] || eventdata['yaxis.range[0]']) {
        Plotly.relayout('plot', {
          'xaxis.range': [-10, 50],
          'yaxis.range': [0, 1600]
        });
      }
    });

  </script>

</body>
</html>
